# AI Assistant 기획서

> **Version**: 1.0.0  
> **Last Updated**: 2026-01-19  
> **관련 컴포넌트**: `frontend/js/features/ai-assistant.js`  
> **관련 백엔드**: `server/gemini_backend.py`, `server/ai_tools.py`

---

## 목차

1. [기능 개요](#1-기능-개요)
2. [UI/UX 설계](#2-uiux-설계)
3. [사용자별 기능 차별화](#3-사용자별-기능-차별화)
4. [Tool (Function Calling)](#4-tool-function-calling)
5. [대화 흐름](#5-대화-흐름)
6. [프롬프트 시스템](#6-프롬프트-시스템)
7. [에러 처리](#7-에러-처리)
8. [API 명세](#8-api-명세)

---

## 1. 기능 개요

### 1.1 목적

사용자와의 자연어 대화를 통해 물류 플랫폼의 모든 기능을 손쉽게 이용할 수 있도록 지원하는 AI 어시스턴트입니다.

### 1.2 핵심 기능

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          AI Assistant 기능                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │                        자연어 대화                                │   │
│  │  "부산에서 로테르담까지 40HC 2대 운임 알려줘"                      │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                              │                                          │
│                              ▼                                          │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │                     Tool Calling (Gemini)                        │   │
│  │  • get_ocean_rates(pol="KRPUS", pod="NLRTM", type="40HC")       │   │
│  │  • get_bidding_status(status="open")                             │   │
│  │  • get_shipping_indices(type="BDI")                              │   │
│  │  • get_latest_news(category="crisis")                            │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                              │                                          │
│                              ▼                                          │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │                      사용자 맞춤 응답                             │   │
│  │  • Guest: 일반 정보 제공                                         │   │
│  │  • Shipper: 본인 비딩 정보, 견적 요청 지원                        │   │
│  │  • Forwarder: 전체 비딩 조회, 입찰 안내                           │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 1.3 지원 기능

| 기능 | 설명 | 관련 Tool |
|------|------|-----------|
| **운임 조회** | 해상/항공 운임 실시간 조회 | `get_ocean_rates`, `get_air_rates` |
| **비딩 현황** | 비딩 목록 및 상세 조회 | `get_bidding_status` |
| **시장 지수** | BDI, SCFI, CCFI 조회 | `get_shipping_indices` |
| **뉴스 조회** | 물류 뉴스 조회 | `get_latest_news` |
| **환율 조회** | 실시간 환율 조회 | `get_exchange_rates` |
| **페이지 안내** | 기능 페이지 안내 | `navigate_to_page` |

---

## 2. UI/UX 설계

### 2.1 사이드바 채팅 UI

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              Page Content                                │
│                                                                          │
│                                                                          │
│                                          ┌────────────────────────────┐ │
│                                          │  AAL Assistant        [✕]  │ │
│                                          ├────────────────────────────┤ │
│                                          │                            │ │
│                                          │  안녕하세요, 홍길동님! 👋   │ │
│                                          │  무엇을 도와드릴까요?      │ │
│                                          │                            │ │
│                                          │  ┌────────────────────┐   │ │
│                                          │  │ 부산에서 로테르담   │   │ │
│                                          │  │ 40HC 2대 운임?      │   │ │
│                                          │  └────────────────────┘   │ │
│                                          │                    User ● │ │
│                                          │                            │ │
│                                          │  ● AI                      │ │
│                                          │  ┌────────────────────┐   │ │
│                                          │  │ 📊 운임 조회 결과   │   │ │
│                                          │  │                    │   │ │
│                                          │  │ 구간: KRPUS → NLRTM│   │ │
│                                          │  │ 컨테이너: 40'HC    │   │ │
│                                          │  │                    │   │ │
│                                          │  │ 기본운임: $2,500   │   │ │
│                                          │  │ 부대비용: ₩400,000 │   │ │
│                                          │  │                    │   │ │
│                                          │  │ 견적 요청하시겠어요?│   │ │
│                                          │  └────────────────────┘   │ │
│                                          │                            │ │
│                                          ├────────────────────────────┤ │
│                                          │  [메시지 입력...]    [📤]  │ │
│                                          └────────────────────────────┘ │
│                                                                          │
│                                                               [🤖 AI]   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 UI 컴포넌트

#### 2.2.1 토글 버튼

| 상태 | 위치 | 동작 |
|------|------|------|
| **닫힘** | 우측 하단 고정 | 클릭 시 사이드바 열림 |
| **열림** | 사이드바 내 X 버튼 | 클릭 시 사이드바 닫힘 |

**스타일**:
```css
.ai-toggle-btn {
  position: fixed;
  right: 24px;
  bottom: 24px;
  width: 56px;
  height: 56px;
  border-radius: 28px;
  background: linear-gradient(135deg, #3b82f6, #8b5cf6);
  z-index: 9998;
}
```

#### 2.2.2 사이드바

| 속성 | 값 |
|------|-----|
| **Width** | 380px |
| **Position** | Fixed, Right |
| **Animation** | Slide from Right (0.3s) |
| **Background** | #111827 |
| **Z-index** | 9999 |

#### 2.2.3 메시지 스타일

**사용자 메시지**:
```css
.ai-message.user {
  background: #3b82f6;
  color: white;
  margin-left: auto;
  border-radius: 12px 12px 4px 12px;
}
```

**AI 메시지**:
```css
.ai-message.ai {
  background: #1f2937;
  color: #e5e7eb;
  border-radius: 12px 12px 12px 4px;
}
```

### 2.3 페이지 전환 시 동작

| 상황 | 동작 |
|------|------|
| **페이지 이동 요청** | 네비게이션 버튼 표시 |
| **네비게이션 클릭** | sessionStorage에 상태 저장 → 페이지 이동 → 자동 열림 |
| **새로고침** | 대화 이력 복원 (sessionStorage) |

---

## 3. 사용자별 기능 차별화

### 3.1 Tool Access Matrix

| Tool | Guest | Shipper | Forwarder |
|------|:-----:|:-------:|:---------:|
| **get_ocean_rates** | ✅ | ✅ | ✅ |
| **get_air_rates** | ✅ | ✅ | ✅ |
| **get_schedules** | ✅ | ✅ | ✅ |
| **get_shipping_indices** | ✅ | ✅ | ✅ |
| **get_latest_news** | ✅ | ✅ | ✅ |
| **get_exchange_rates** | ✅ | ✅ | ✅ |
| **get_port_info** | ✅ | ✅ | ✅ |
| **navigate_to_page** | ✅ | ✅ | ✅ |
| **create_quote_request** | ❌ | ✅ | ❌ |
| **get_my_quotes** | ❌ | ✅ | ❌ |
| **get_bidding_status** | ❌ | ✅ (본인) | ✅ (전체) |
| **award_bid** | ❌ | ✅ | ❌ |
| **submit_bid** | ❌ | ❌ | ✅ |
| **get_my_bids** | ❌ | ❌ | ✅ |

### 3.2 응답 차별화

#### 3.2.1 Guest (비로그인)

**"비딩 현황 알려줘" 질의 시**:
```
🔒 비딩 현황을 확인하려면 로그인이 필요합니다.

📌 **로그인 후 이용 가능한 기능:**
- 화주로 로그인 시: 내가 요청한 견적의 비딩 현황 확인
- 포워더로 로그인 시: 전체 입찰 가능한 비딩 목록 확인

👉 [로그인 페이지로 이동]
```

#### 3.2.2 Shipper (화주)

**"비딩 현황 알려줘" 질의 시**:
```
📋 **아로와랩스님의 비딩 현황** (진행중: 5건)

🟢 EXSEA00025 - KRPUS → NLRTM
   해상 | FCL | 40'HC × 2 | ETD: 2026-01-25
   입찰: 3건 | 마감: 2026-01-22

🟢 IMAIR00015 - CNSHA → KRICN
   항공 | 850 KGS | ETD: 2026-01-23
   입찰: 1건 | 마감: 2026-01-20

총 5건의 비딩이 진행 중입니다.
입찰 내역을 확인하시겠어요?
```

#### 3.2.3 Forwarder (포워더)

**"비딩 현황 알려줘" 질의 시**:
```
📋 **입찰 가능한 비딩** (진행중: 38건)

🟢 EXSEA00025 - KRPUS → NLRTM
   해상 | FCL | 40'HC × 2 | ETD: 2026-01-25
   화주: 아로와랩스 | 마감: 2026-01-22

🟢 EXSEA00024 - KRPUS → NLRTM
   해상 | FCL | 20'GP × 5 | ETD: 2026-01-24
   화주: 삼성물류 | 마감: 2026-01-21

💡 관심 있는 비딩에 입찰해보세요!
```

### 3.3 사용자 컨텍스트 전달

**Frontend → Backend**:
```javascript
// ai-assistant.js
function getUserContext() {
  const user = JSON.parse(localStorage.getItem('user'));
  if (user) {
    return {
      user_id: user.id,
      user_type: user.user_type,  // 'shipper' | 'forwarder'
      company: user.company,
      name: user.name,
      email: user.email
    };
  }
  return null;  // Guest
}

// API 호출
fetch('/api/ai/chat', {
  method: 'POST',
  body: JSON.stringify({
    session_id: getSessionId(),
    message: userMessage,
    user_context: getUserContext()
  })
});
```

---

## 4. Tool (Function Calling)

### 4.1 Tool 정의

```python
# ai_tools.py

TOOL_DEFINITIONS = [
    {
        "name": "get_ocean_rates",
        "description": "해상 운임을 조회합니다.",
        "parameters": {
            "type": "object",
            "properties": {
                "pol": {"type": "string", "description": "출발 항구 코드"},
                "pod": {"type": "string", "description": "도착 항구 코드"},
                "container_type": {"type": "string", "description": "컨테이너 타입"}
            },
            "required": ["pol", "pod"]
        }
    },
    {
        "name": "get_bidding_status",
        "description": "비딩 현황을 조회합니다.",
        "parameters": {
            "type": "object",
            "properties": {
                "status": {
                    "type": "string",
                    "enum": ["open", "closed", "awarded", "all"]
                },
                "limit": {"type": "integer"},
                "customer_email": {"type": "string"}  # Shipper 자동 주입
            }
        }
    },
    # ... 기타 Tool 정의
]
```

### 4.2 Tool 실행 플로우

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       Tool Calling 플로우                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  [사용자 메시지]                                                          │
│       │                                                                  │
│       ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ 1. Gemini API 호출 (with Tools)                                 │    │
│  │    - System Prompt + User Context                               │    │
│  │    - Tool Definitions                                            │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│       │                                                                  │
│       ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ 2. Gemini 응답 분석                                              │    │
│  │    - function_call 있음 → Tool 실행                              │    │
│  │    - function_call 없음 → 텍스트 응답                            │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│       │                                                                  │
│       ▼ (function_call 있는 경우)                                        │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ 3. 권한 검증 (check_tool_access)                                 │    │
│  │    - Guest가 shipper 전용 Tool 호출 → 로그인 안내                │    │
│  │    - 권한 있음 → Tool 실행                                       │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│       │                                                                  │
│       ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ 4. 파라미터 자동 주입 (사용자 컨텍스트 기반)                       │    │
│  │    - Shipper: customer_email 자동 주입                          │    │
│  │    - Forwarder: forwarder_email 자동 주입                       │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│       │                                                                  │
│       ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ 5. Tool 실행 및 결과 반환                                        │    │
│  │    - DB 조회 / API 호출                                         │    │
│  │    - 결과 포맷팅                                                 │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│       │                                                                  │
│       ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │ 6. Gemini 후처리 (Tool 결과 기반 응답 생성)                       │    │
│  │    - Tool 결과를 자연어로 변환                                   │    │
│  │    - 추가 안내/질문 포함                                         │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│       │                                                                  │
│       ▼                                                                  │
│  [AI 응답 반환]                                                          │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 4.3 Tool 상세

#### 4.3.1 get_ocean_rates

| 항목 | 값 |
|------|-----|
| **설명** | 해상 운임 조회 |
| **파라미터** | pol (출발), pod (도착), container_type (선택) |
| **데이터 소스** | OceanRateSheet, OceanRateItem |
| **반환** | 운임 항목 목록, 총액 |

**예시 호출**:
```json
{
  "name": "get_ocean_rates",
  "parameters": {
    "pol": "KRPUS",
    "pod": "NLRTM",
    "container_type": "40HC"
  }
}
```

**반환 예시**:
```json
{
  "success": true,
  "route": "KRPUS → NLRTM",
  "container": "40'HC",
  "rates": [
    {"code": "FRT", "name": "Ocean Freight", "amount": 2500, "currency": "USD"},
    {"code": "THC", "name": "Terminal", "amount": 200000, "currency": "KRW"}
  ],
  "total_usd": 2500,
  "total_krw": 200000
}
```

#### 4.3.2 get_bidding_status

| 항목 | 값 |
|------|-----|
| **설명** | 비딩 현황 조회 |
| **파라미터** | status, limit, customer_email (자동 주입) |
| **데이터 소스** | Bidding, QuoteRequest |
| **권한** | Shipper: 본인 건만, Forwarder: 전체 |

#### 4.3.3 get_shipping_indices

| 항목 | 값 |
|------|-----|
| **설명** | 해운 지수 조회 |
| **파라미터** | index_type (BDI/SCFI/CCFI/all), days |
| **데이터 소스** | shipping_indices.db |
| **권한** | 전체 |

#### 4.3.4 get_latest_news

| 항목 | 값 |
|------|-----|
| **설명** | 물류 뉴스 조회 |
| **파라미터** | category, is_crisis, news_type, limit |
| **데이터 소스** | news_intelligence.db |
| **권한** | 전체 |

---

## 5. 대화 흐름

### 5.1 운임 조회 대화

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        운임 조회 대화 흐름                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  User: "부산에서 로테르담까지 운임 알려줘"                                │
│                                                                          │
│  AI: 📊 **해상 운임 조회 결과**                                          │
│                                                                          │
│      구간: KRPUS(부산) → NLRTM(로테르담)                                 │
│      컨테이너: 40'HC (기본)                                              │
│                                                                          │
│      | 항목 | 금액 |                                                     │
│      |------|------|                                                     │
│      | 해상운임 (FRT) | $2,500 |                                         │
│      | 유류할증료 (BAF) | $350 |                                          │
│      | 터미널비 (THC) | ₩200,000 |                                       │
│      | 서류비 (DOC) | ₩50,000 |                                          │
│                                                                          │
│      **총액: $2,850 + ₩250,000**                                        │
│                                                                          │
│      💡 다른 컨테이너 타입이나 수량이 필요하시면 말씀해주세요!             │
│         견적 요청을 진행하시겠어요?                                       │
│                                                                          │
│  User: "40HC 2대로 견적 요청해줘"                                        │
│                                                                          │
│  AI: (로그인 상태 확인)                                                  │
│      - 비로그인 → "견적 요청은 로그인이 필요합니다."                       │
│      - 화주 → 견적 요청 진행                                             │
│      - 포워더 → "견적 요청은 화주만 가능합니다."                          │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 5.2 비딩 생성 대화 (화주)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        비딩 생성 대화 흐름                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  User: "부산에서 함부르크까지 20GP 3대 해상 운송 견적 부탁해"             │
│                                                                          │
│  AI: 📋 **수집된 정보**                                                  │
│                                                                          │
│      ✅ 운송 유형: 해상 (Ocean)                                          │
│      ✅ 적재 유형: FCL                                                   │
│      ✅ 출발지: KRPUS (부산)                                             │
│      ✅ 도착지: DEHAM (함부르크)                                         │
│      ✅ 컨테이너: 20'GP × 3                                              │
│      ✅ 거래 유형: 수출 (자동)                                           │
│      ⏳ 출발 예정일(ETD): ?                                              │
│                                                                          │
│      출발 예정일을 알려주세요!                                            │
│                                                                          │
│  User: "1월 30일"                                                        │
│                                                                          │
│  AI: 📋 **최종 확인**                                                    │
│                                                                          │
│      | 항목 | 내용 |                                                     │
│      |------|------|                                                     │
│      | 운송 | 해상 FCL |                                                 │
│      | 구간 | KRPUS → DEHAM |                                           │
│      | 화물 | 20'GP × 3 |                                               │
│      | ETD | 2026-01-30 |                                               │
│      | 거래 | 수출 |                                                     │
│                                                                          │
│      이대로 비딩을 생성할까요? (예/아니오)                                │
│                                                                          │
│  User: "예"                                                              │
│                                                                          │
│  AI: ✅ **비딩이 생성되었습니다!**                                       │
│                                                                          │
│      비딩번호: **EXSEA00026**                                            │
│      마감일: 2026-01-27 23:59                                           │
│                                                                          │
│      포워더들의 입찰을 기다려보세요!                                      │
│                                                                          │
│      [📄 RFQ PDF 다운로드] [📋 비딩 상세 보기]                           │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 5.3 시장 정보 조회

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       시장 정보 조회 대화 흐름                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  User: "요즘 해운 시장 어때?"                                            │
│                                                                          │
│  AI: 📊 **해운 시장 동향**                                               │
│                                                                          │
│      **BDI (Baltic Dry Index)**                                         │
│      현재: 1,523 (▼ -15, -0.98%)                                        │
│      최근 7일간 하락 추세                                                │
│                                                                          │
│      **SCFI (Shanghai Containerized)**                                  │
│      현재: 1,845.32 (▲ +23.15, +1.27%)                                  │
│      컨테이너 운임 소폭 상승                                             │
│                                                                          │
│      **CCFI (China Containerized)**                                     │
│      현재: 1,156.78 (▲ +8.92, +0.78%)                                   │
│                                                                          │
│      💡 홍해 지역 불안정으로 아시아-유럽 노선 운임 상승 압박 지속         │
│                                                                          │
│      더 자세한 분석이나 뉴스를 보시겠어요?                                │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 6. 프롬프트 시스템

### 6.1 기본 시스템 프롬프트

```python
SYSTEM_PROMPT = """당신은 AAL(Asia Logistics Link) 물류 플랫폼의 AI 어시스턴트입니다.

# 핵심 역할
- 운임 조회, 견적 요청, 비딩 관리, 시장 정보 제공
- 사용자 문의에서 정보를 자동 추출하여 스마트하게 응답
- Tool을 활용하여 실시간 데이터 조회 및 작업 수행

# 기본 규칙
1. 한국어로 친절하게 응답
2. 이미 제공된 정보는 다시 묻지 않음
3. Tool 호출 결과를 바탕으로 정확한 정보 제공
4. 불확실한 정보는 추측하지 않고 확인 요청

# 응답 스타일
- 명확하고 구조화된 응답
- 필요한 경우 이모지 활용
- 숫자는 천 단위 구분 (예: ₩2,392,100)
"""
```

### 6.2 사용자 유형별 추가 프롬프트

```python
# Shipper 프롬프트
SHIPPER_PROMPT = """
# 현재 사용자: 화주 (Shipper)
- 회사: {company}
- 이름: {name}
- 이메일: {email}

# 화주 전용 기능
- 비딩 현황 조회 시 본인 요청 건만 표시
- 견적 요청 생성 가능
- 입찰 비교 및 낙찰 처리 가능

# 화주 제한 사항
- 입찰 제출 불가 → "입찰은 포워더만 가능합니다"
"""

# Forwarder 프롬프트
FORWARDER_PROMPT = """
# 현재 사용자: 포워더 (Forwarder)
- 회사: {company}
- 이름: {name}
- 이메일: {email}

# 포워더 전용 기능
- 전체 Open 비딩 조회 가능
- 입찰 제출 가능
- 내 입찰 현황 조회 가능

# 포워더 제한 사항
- 견적 요청 불가 → "견적 요청은 화주만 가능합니다"
"""
```

### 6.3 에스컬레이션 정책

```python
ESCALATION_PROMPT = """
# 에스컬레이션 조건

다음 상황에서는 AI가 직접 처리하지 않고 담당자 안내:

1. **클레임/분쟁 관련**
   → "해당 건은 담당자 확인이 필요합니다. 고객센터로 연락 주세요."

2. **특수 운송 (위험물, 냉동 대량)**
   → "특수 운송은 별도 견적이 필요합니다. 담당자가 연락드리겠습니다."

3. **계약 조건 협상**
   → "계약 조건 협상은 담당 매니저와 진행해 주세요."

4. **시스템 오류**
   → "일시적인 오류가 발생했습니다. 잠시 후 다시 시도해 주세요."
"""
```

---

## 7. 에러 처리

### 7.1 에러 유형

| 에러 | 사용자 메시지 |
|------|---------------|
| **로그인 필요** | "해당 기능은 로그인이 필요합니다. 로그인 하시겠어요?" |
| **권한 없음** | "해당 기능은 {user_type} 전용입니다." |
| **데이터 없음** | "조회 결과가 없습니다. 검색 조건을 확인해주세요." |
| **API 오류** | "일시적인 오류가 발생했습니다. 잠시 후 다시 시도해 주세요." |
| **AI 오류** | "죄송합니다, 이해하지 못했어요. 다시 말씀해 주시겠어요?" |

### 7.2 Fallback 응답

```python
FALLBACK_RESPONSES = {
    "unknown_intent": "죄송합니다, 이해하지 못했어요. 다음과 같은 것들을 도와드릴 수 있어요:\n"
                      "• 운임 조회 (예: '부산-로테르담 40HC 운임')\n"
                      "• 비딩 현황 (예: '내 비딩 현황 알려줘')\n"
                      "• 시장 지수 (예: 'BDI 지수 어때?')\n"
                      "• 뉴스 (예: '물류 뉴스 보여줘')",
    
    "api_error": "⚠️ 일시적인 오류가 발생했습니다.\n"
                 "잠시 후 다시 시도해 주세요.",
    
    "no_data": "📭 조회 결과가 없습니다.\n"
               "검색 조건을 확인해주세요."
}
```

---

## 8. API 명세

### 8.1 AI 채팅

**Endpoint**: `POST /api/ai/chat`

**Request Body**:
```json
{
  "session_id": "session_1705654321_abc123",
  "message": "부산에서 로테르담 40HC 운임 알려줘",
  "user_context": {
    "user_id": 1,
    "user_type": "shipper",
    "company": "아로와랩스",
    "name": "홍길동",
    "email": "user@example.com"
  }
}
```

**Response**:
```json
{
  "success": true,
  "message": "📊 **해상 운임 조회 결과**\n\n구간: KRPUS(부산) → NLRTM(로테르담)...",
  "tool_used": ["get_ocean_rates"],
  "navigation": null,
  "quote_data": {
    "pol": "KRPUS",
    "pod": "NLRTM",
    "container_type": "40HC",
    "rates": [...]
  }
}
```

### 8.2 대화 이력 조회

**Endpoint**: `GET /api/ai/history`

**Query Parameters**:
| 파라미터 | 타입 | 필수 | 설명 |
|----------|------|------|------|
| session_id | string | Y | 세션 ID |
| limit | number | N | 최대 건수 (기본: 50) |

**Response**:
```json
{
  "success": true,
  "history": [
    {
      "role": "user",
      "content": "부산에서 로테르담 운임 알려줘",
      "timestamp": "2026-01-19T10:30:00Z"
    },
    {
      "role": "assistant",
      "content": "📊 해상 운임 조회 결과...",
      "tool_used": ["get_ocean_rates"],
      "timestamp": "2026-01-19T10:30:02Z"
    }
  ]
}
```

---

## 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 1.0.0 | 2026-01-19 | - | 초기 작성 |
